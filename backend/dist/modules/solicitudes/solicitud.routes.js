import { Router } from 'express';
import { authenticate } from '@middleware/auth.middleware';
import { requirePermission } from '@middleware/authorization.middleware';
import { auditarAccion } from '@middleware/audit.middleware';
import { solicitudController } from './solicitud.controller';
import { validate, validateQuery } from './dtos';
import { CreateSolicitudDTO, DerivarEditorDTO, ActaEncontradaDTO, ActaNoEncontradaDTO, ValidarPagoDTO, IniciarProcesamientoDTO, AprobarUGELDTO, ObservarUGELDTO, CorregirObservacionDTO, RegistrarSIAGECDTO, FirmarCertificadoDTO, MarcarEntregadoDTO, FiltrosSolicitudDTO, } from './dtos';
const router = Router();
router.post('/crear', validate(CreateSolicitudDTO), solicitudController.crear.bind(solicitudController));
router.get('/seguimiento/:codigo', solicitudController.seguimiento.bind(solicitudController));
router.use(authenticate);
router.get('/mesa-partes/pendientes-derivacion', requirePermission(['SOLICITUDES_VER', 'MESA_DE_PARTES']), solicitudController.pendientesDerivacion.bind(solicitudController));
router.post('/:id/mesa-partes/derivar-editor', requirePermission(['SOLICITUDES_DERIVAR', 'MESA_DE_PARTES']), validate(DerivarEditorDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.derivarEditor.bind(solicitudController));
router.post('/:id/mesa-partes/validar-pago-efectivo', requirePermission(['SOLICITUDES_VALIDAR_PAGO', 'MESA_DE_PARTES']), validate(ValidarPagoDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.validarPagoEfectivo.bind(solicitudController));
router.get('/mesa-partes/listas-entrega', requirePermission(['SOLICITUDES_VER', 'MESA_DE_PARTES']), solicitudController.listasEntrega.bind(solicitudController));
router.post('/:id/mesa-partes/marcar-entregado', requirePermission(['SOLICITUDES_ENTREGAR', 'MESA_DE_PARTES']), validate(MarcarEntregadoDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.marcarEntregado.bind(solicitudController));
router.get('/editor/asignadas-busqueda', requirePermission(['SOLICITUDES_VER', 'EDITOR']), solicitudController.asignadasBusqueda.bind(solicitudController));
router.post('/:id/editor/iniciar-busqueda', requirePermission(['SOLICITUDES_BUSCAR', 'EDITOR']), auditarAccion('solicitud', (req) => req.params.id), solicitudController.iniciarBusqueda.bind(solicitudController));
router.post('/:id/editor/acta-encontrada', requirePermission(['SOLICITUDES_GESTIONAR', 'EDITOR']), validate(ActaEncontradaDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.actaEncontrada.bind(solicitudController));
router.post('/:id/editor/acta-no-encontrada', requirePermission(['SOLICITUDES_GESTIONAR', 'EDITOR']), validate(ActaNoEncontradaDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.actaNoEncontrada.bind(solicitudController));
router.post('/:id/editor/iniciar-procesamiento', requirePermission(['SOLICITUDES_PROCESAR', 'EDITOR']), validate(IniciarProcesamientoDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.iniciarProcesamiento.bind(solicitudController));
router.post('/:id/editor/enviar-validacion-ugel', requirePermission(['SOLICITUDES_GESTIONAR', 'EDITOR']), auditarAccion('solicitud', (req) => req.params.id), solicitudController.enviarValidacionUGEL.bind(solicitudController));
router.post('/:id/editor/corregir-observacion', requirePermission(['SOLICITUDES_GESTIONAR', 'EDITOR']), validate(CorregirObservacionDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.corregirObservacion.bind(solicitudController));
router.get('/ugel/pendientes-validacion', requirePermission(['SOLICITUDES_VER', 'UGEL']), solicitudController.pendientesValidacionUGEL.bind(solicitudController));
router.post('/:id/ugel/aprobar', requirePermission(['SOLICITUDES_VALIDAR', 'UGEL']), validate(AprobarUGELDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.aprobarUGEL.bind(solicitudController));
router.post('/:id/ugel/observar', requirePermission(['SOLICITUDES_VALIDAR', 'UGEL']), validate(ObservarUGELDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.observarUGEL.bind(solicitudController));
router.get('/siagec/pendientes-registro', requirePermission(['SOLICITUDES_VER', 'SIAGEC']), solicitudController.pendientesRegistroSIAGEC.bind(solicitudController));
router.post('/:id/siagec/registrar', requirePermission(['SOLICITUDES_REGISTRAR', 'SIAGEC']), validate(RegistrarSIAGECDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.registrarSIAGEC.bind(solicitudController));
router.get('/direccion/pendientes-firma', requirePermission(['SOLICITUDES_VER', 'DIRECCION']), solicitudController.pendientesFirma.bind(solicitudController));
router.post('/:id/direccion/firmar', requirePermission(['SOLICITUDES_FIRMAR', 'DIRECCION']), validate(FirmarCertificadoDTO), auditarAccion('solicitud', (req) => req.params.id), solicitudController.firmarCertificado.bind(solicitudController));
router.get('/', requirePermission(['SOLICITUDES_VER']), validateQuery(FiltrosSolicitudDTO), solicitudController.listar.bind(solicitudController));
router.get('/:id', requirePermission(['SOLICITUDES_VER']), solicitudController.obtenerPorId.bind(solicitudController));
router.get('/:id/historial', requirePermission(['SOLICITUDES_VER']), solicitudController.obtenerHistorial.bind(solicitudController));
router.get('/dashboard', requirePermission(['SOLICITUDES_VER', 'ADMIN']), solicitudController.dashboard.bind(solicitudController));
export default router;
//# sourceMappingURL=solicitud.routes.js.map