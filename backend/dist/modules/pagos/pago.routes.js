import { Router } from 'express';
import { authenticate } from '@middleware/auth.middleware';
import { requirePermission } from '@middleware/authorization.middleware';
import { auditarAccion } from '@middleware/audit.middleware';
import { pagoController } from './pago.controller';
import { metodoPagoController } from './metodo-pago.controller';
import { reporteController } from './reporte.controller';
import { uploadComprobante, handleMulterError, } from './upload-comprobante.middleware';
import { validate, validateQuery } from './dtos';
import { GenerarOrdenDTO, SubirComprobanteDTO, ValidarPagoManualDTO, RechazarComprobanteDTO, RegistrarPagoEfectivoDTO, WebhookPagoDTO, FiltrosPagoDTO, CreateMetodoPagoDTO, UpdateMetodoPagoDTO, } from './dtos';
const router = Router();
router.post('/webhook', validate(WebhookPagoDTO), pagoController.recibirWebhook.bind(pagoController));
router.use(authenticate);
router.post('/orden', requirePermission(['PAGOS_CREAR']), validate(GenerarOrdenDTO), auditarAccion('pago'), pagoController.generarOrden.bind(pagoController));
router.post('/:id/comprobante', requirePermission(['PAGOS_CREAR']), uploadComprobante, handleMulterError, validate(SubirComprobanteDTO), auditarAccion('pago', (req) => req.params.id), pagoController.subirComprobante.bind(pagoController));
router.get('/metodos/activos', metodoPagoController.listarActivos.bind(metodoPagoController));
router.get('/pendientes-validacion', requirePermission(['PAGOS_VALIDAR', 'MESA_DE_PARTES']), pagoController.getPendientesValidacion.bind(pagoController));
router.post('/:id/registrar-efectivo', requirePermission(['PAGOS_VALIDAR', 'MESA_DE_PARTES']), validate(RegistrarPagoEfectivoDTO), auditarAccion('pago', (req) => req.params.id), pagoController.registrarEfectivo.bind(pagoController));
router.post('/:id/validar-manual', requirePermission(['PAGOS_VALIDAR', 'MESA_DE_PARTES']), validate(ValidarPagoManualDTO), auditarAccion('pago', (req) => req.params.id), pagoController.validarManual.bind(pagoController));
router.post('/:id/rechazar-comprobante', requirePermission(['PAGOS_VALIDAR', 'MESA_DE_PARTES']), validate(RechazarComprobanteDTO), auditarAccion('pago', (req) => req.params.id), pagoController.rechazarComprobante.bind(pagoController));
router.get('/', requirePermission(['PAGOS_VER', 'ADMIN']), validateQuery(FiltrosPagoDTO), pagoController.listar.bind(pagoController));
router.get('/:id', requirePermission(['PAGOS_VER']), pagoController.obtenerPorId.bind(pagoController));
router.post('/marcar-expiradas', requirePermission(['ADMIN']), pagoController.marcarExpiradas.bind(pagoController));
router.post('/metodos/seed', requirePermission(['ADMIN']), metodoPagoController.seed.bind(metodoPagoController));
router.get('/metodos', requirePermission(['PAGOS_VER', 'ADMIN']), metodoPagoController.listar.bind(metodoPagoController));
router.get('/metodos/:id', requirePermission(['PAGOS_VER', 'ADMIN']), metodoPagoController.obtenerPorId.bind(metodoPagoController));
router.post('/metodos', requirePermission(['PAGOS_EDITAR', 'ADMIN']), validate(CreateMetodoPagoDTO), auditarAccion('metodopago'), metodoPagoController.crear.bind(metodoPagoController));
router.put('/metodos/:id', requirePermission(['PAGOS_EDITAR', 'ADMIN']), validate(UpdateMetodoPagoDTO), auditarAccion('metodopago', (req) => req.params.id), metodoPagoController.actualizar.bind(metodoPagoController));
router.patch('/metodos/:id/toggle', requirePermission(['PAGOS_EDITAR', 'ADMIN']), auditarAccion('metodopago', (req) => req.params.id), metodoPagoController.toggle.bind(metodoPagoController));
router.delete('/metodos/:id', requirePermission(['PAGOS_EDITAR', 'ADMIN']), auditarAccion('metodopago', (req) => req.params.id), metodoPagoController.eliminar.bind(metodoPagoController));
router.get('/reportes/periodo', requirePermission(['PAGOS_VER', 'ADMIN']), reporteController.reportePorPeriodo.bind(reporteController));
router.get('/reportes/metodo', requirePermission(['PAGOS_VER', 'ADMIN']), reporteController.reportePorMetodo.bind(reporteController));
router.get('/reportes/pendientes', requirePermission(['PAGOS_VER', 'MESA_DE_PARTES', 'ADMIN']), reporteController.reportePendientes.bind(reporteController));
router.get('/reportes/noconciliados', requirePermission(['PAGOS_VER', 'ADMIN']), reporteController.reporteNoConciliados.bind(reporteController));
router.get('/reportes/exportar', requirePermission(['PAGOS_VER', 'ADMIN']), reporteController.exportarExcel.bind(reporteController));
export default router;
//# sourceMappingURL=pago.routes.js.map