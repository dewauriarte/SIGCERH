generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model actafisica {
  id                    String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  numero                String      @db.VarChar(50)
  tipo                  String      @db.VarChar(30)
  aniolectivo_id        String      @db.Uuid
  grado_id              String      @db.Uuid
  seccion               String?     @db.VarChar(10)
  turno                 String?     @db.VarChar(20)
  fechaemision          DateTime?   @db.Date
  libro_id              String?     @db.Uuid
  folio                 String?     @db.VarChar(50)
  tipoevaluacion        String?     @db.VarChar(50)
  colegiorigen          String?     @db.VarChar(255)
  ubicacionfisica       String?     @db.VarChar(255)
  nombrearchivo         String?     @db.VarChar(255)
  urlarchivo            String?
  hasharchivo           String?     @db.VarChar(64)
  estado                String?     @default("DISPONIBLE") @db.VarChar(30)
  solicitud_id          String?     @db.Uuid
  procesadoconia        Boolean?    @default(false)
  fechaprocesamiento    DateTime?   @db.Timestamptz(6)
  datosextraidosjson    Json?
  urlexcelexportado     String?
  fechaexportacionexcel DateTime?   @db.Timestamptz(6)
  observaciones         String?
  usuariosubida_id      String?     @db.Uuid
  fechasubida           DateTime?   @default(now()) @db.Timestamptz(6)
  aniolectivo           aniolectivo @relation(fields: [aniolectivo_id], references: [id], onUpdate: NoAction, map: "fk_acta_anio")
  grado                 grado       @relation(fields: [grado_id], references: [id], onUpdate: NoAction, map: "fk_acta_grado")
  libro                 libro?      @relation(fields: [libro_id], references: [id], onUpdate: NoAction, map: "fk_acta_libro")
  solicitud             solicitud?  @relation(fields: [solicitud_id], references: [id], onUpdate: NoAction, map: "fk_acta_solicitud")
  usuario               usuario?    @relation(fields: [usuariosubida_id], references: [id], onUpdate: NoAction, map: "fk_acta_usuario")

  @@unique([numero, aniolectivo_id])
  @@index([aniolectivo_id], map: "idx_acta_anio")
  @@index([grado_id], map: "idx_acta_grado")
  @@index([hasharchivo], map: "idx_acta_hash")
  @@index([estado], map: "idx_acta_estado")
  @@index([libro_id], map: "idx_acta_libro")
  @@index([solicitud_id], map: "idx_acta_solicitud")
  @@index([datosextraidosjson], map: "idx_acta_json", type: Gin)
  @@index([numero], map: "idx_acta_numero")
  @@index([procesadoconia], map: "idx_acta_procesado")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model aniolectivo {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @default(dbgenerated("obtener_institucion_sesion()")) @db.Uuid
  anio                     Int
  fechainicio              DateTime                 @db.Date
  fechafin                 DateTime                 @db.Date
  activo                   Boolean?                 @default(false)
  observaciones            String?
  actafisica               actafisica[]
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onUpdate: NoAction, map: "fk_anio_institucion")
  certificadodetalle       certificadodetalle[]
  curriculogrado           curriculogrado[]

  @@unique([institucion_id, anio])
  @@index([institucion_id, anio(sort: Desc)], map: "idx_anio_inst_anio")
  @@index([institucion_id], map: "idx_anio_institucion")
}

model areacurricular {
  id                       String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String?                   @db.Uuid
  codigo                   String                    @db.VarChar(20)
  nombre                   String                    @db.VarChar(150)
  orden                    Int
  escompetenciatransversal Boolean?                  @default(false)
  activo                   Boolean?                  @default(true)
  configuracioninstitucion configuracioninstitucion? @relation(fields: [institucion_id], references: [id], onDelete: Restrict, onUpdate: NoAction, map: "fk_area_institucion")
  certificadonota          certificadonota[]
  curriculogrado           curriculogrado[]

  @@unique([institucion_id, codigo])
  @@index([institucion_id, codigo], map: "idx_area_inst_codigo")
  @@index([institucion_id], map: "idx_area_institucion")
  @@index([orden], map: "idx_area_orden")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model auditoria {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  entidad         String    @db.VarChar(50)
  entidadid       String    @db.Uuid
  accion          String    @db.VarChar(30)
  datosanteriores Json?
  datosnuevos     Json?
  usuario_id      String?   @db.Uuid
  ip              String?   @db.VarChar(45)
  useragent       String?
  fecha           DateTime? @default(now()) @db.Timestamptz(6)
  usuario         usuario?  @relation(fields: [usuario_id], references: [id], onUpdate: NoAction, map: "fk_auditoria_usuario")

  @@index([accion], map: "idx_auditoria_accion")
  @@index([entidad, entidadid], map: "idx_auditoria_entidad")
  @@index([fecha(sort: Desc)], map: "idx_auditoria_fecha")
  @@index([usuario_id], map: "idx_auditoria_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model certificado {
  id                                               String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id                                   String                   @default(dbgenerated("obtener_institucion_sesion()")) @db.Uuid
  codigovirtual                                    String                   @unique @db.VarChar(50)
  numero                                           String?                  @unique @db.VarChar(50)
  estudiante_id                                    String                   @db.Uuid
  fechaemision                                     DateTime                 @db.Date
  horaemision                                      DateTime                 @db.Time(6)
  lugaremision                                     String?                  @default("PUNO") @db.VarChar(100)
  gradoscompletados                                String[]
  situacionfinal                                   String?                  @db.VarChar(50)
  promediogeneral                                  Decimal?                 @db.Decimal(4, 2)
  urlpdf                                           String?
  hashpdf                                          String?                  @db.VarChar(64)
  urlqr                                            String?
  observacionretiros                               String?
  observaciontraslados                             String?
  observacionsiagie                                String?
  observacionpruebasubicacion                      String?
  observacionconvalidacion                         String?
  observacionotros                                 String?
  ordenmerito                                      Int?
  estado                                           String?                  @default("EMITIDO") @db.VarChar(20)
  version                                          Int?                     @default(1)
  esrectificacion                                  Boolean?                 @default(false)
  certificadoanterior_id                           String?                  @db.Uuid
  motivorectificacion                              String?
  usuarioemision_id                                String?                  @db.Uuid
  fechacreacion                                    DateTime?                @default(now()) @db.Timestamptz(6)
  usuarioanulacion_id                              String?                  @db.Uuid
  fechaanulacion                                   DateTime?                @db.Timestamptz(6)
  motivoanulacion                                  String?
  certificado                                      certificado?             @relation("certificadoTocertificado", fields: [certificadoanterior_id], references: [id], onUpdate: NoAction, map: "fk_certificado_anterior")
  other_certificado                                certificado[]            @relation("certificadoTocertificado")
  estudiante                                       estudiante               @relation(fields: [estudiante_id], references: [id], onUpdate: NoAction, map: "fk_certificado_estudiante")
  configuracioninstitucion                         configuracioninstitucion @relation(fields: [institucion_id], references: [id], onUpdate: NoAction, map: "fk_certificado_institucion")
  usuario_certificado_usuarioanulacion_idTousuario usuario?                 @relation("certificado_usuarioanulacion_idTousuario", fields: [usuarioanulacion_id], references: [id], onUpdate: NoAction, map: "fk_certificado_usuario_anulacion")
  usuario_certificado_usuarioemision_idTousuario   usuario?                 @relation("certificado_usuarioemision_idTousuario", fields: [usuarioemision_id], references: [id], onUpdate: NoAction, map: "fk_certificado_usuario_emision")
  certificadodetalle                               certificadodetalle[]
  notificacion                                     notificacion[]
  solicitud                                        solicitud[]
  verificacion                                     verificacion[]

  @@index([codigovirtual], map: "idx_certificado_codigovirtual")
  @@index([estado], map: "idx_certificado_estado")
  @@index([estudiante_id], map: "idx_certificado_estudiante")
  @@index([estudiante_id, estado], map: "idx_certificado_estudiante_estado")
  @@index([fechaemision(sort: Desc)], map: "idx_certificado_fechaemision")
  @@index([institucion_id], map: "idx_certificado_institucion")
  @@index([numero], map: "idx_certificado_numero")
}

model certificadodetalle {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  certificado_id  String            @db.Uuid
  aniolectivo_id  String            @db.Uuid
  grado_id        String            @db.Uuid
  situacionfinal  String?           @db.VarChar(50)
  observaciones   String?
  orden           Int
  aniolectivo     aniolectivo       @relation(fields: [aniolectivo_id], references: [id], onUpdate: NoAction, map: "fk_certdet_anio")
  certificado     certificado       @relation(fields: [certificado_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_certdet_certificado")
  grado           grado             @relation(fields: [grado_id], references: [id], onUpdate: NoAction, map: "fk_certdet_grado")
  certificadonota certificadonota[]

  @@unique([certificado_id, aniolectivo_id, grado_id])
  @@index([aniolectivo_id], map: "idx_certdet_anio")
  @@index([certificado_id], map: "idx_certdet_certificado")
  @@index([grado_id], map: "idx_certdet_grado")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model certificadonota {
  id                    String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  certificadodetalle_id String             @db.Uuid
  area_id               String             @db.Uuid
  nota                  Int?
  notaliteral           String?            @db.VarChar(50)
  esexonerado           Boolean?           @default(false)
  orden                 Int
  areacurricular        areacurricular     @relation(fields: [area_id], references: [id], onUpdate: NoAction, map: "fk_certnota_area")
  certificadodetalle    certificadodetalle @relation(fields: [certificadodetalle_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_certnota_detalle")

  @@unique([certificadodetalle_id, area_id])
  @@index([area_id], map: "idx_certnota_area")
  @@index([certificadodetalle_id], map: "idx_certnota_detalle")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model conciliacionbancaria {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @db.Uuid
  entidadbancaria          String                   @db.VarChar(100)
  fechaconciliacion        DateTime                 @db.Date
  fechainicio              DateTime                 @db.Date
  fechafin                 DateTime                 @db.Date
  totalregistros           Int?
  totalmonto               Decimal?                 @db.Decimal(12, 2)
  archivooriginal_url      String?
  archivonombre            String?                  @db.VarChar(255)
  estado                   String?                  @default("PENDIENTE") @db.VarChar(30)
  observaciones            String?
  usuario_id               String?                  @db.Uuid
  fechacreacion            DateTime?                @default(now()) @db.Timestamptz(6)
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onUpdate: NoAction, map: "fk_conciliacion_institucion")
  usuario                  usuario?                 @relation(fields: [usuario_id], references: [id], onUpdate: NoAction, map: "fk_conciliacion_usuario")
  conciliaciondetalle      conciliaciondetalle[]

  @@index([entidadbancaria], map: "idx_conciliacion_banco")
  @@index([estado], map: "idx_conciliacion_estado")
  @@index([fechaconciliacion(sort: Desc)], map: "idx_conciliacion_fecha")
  @@index([institucion_id], map: "idx_conciliacion_institucion")
}

model conciliaciondetalle {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  conciliacion_id      String               @db.Uuid
  pago_id              String?              @db.Uuid
  numerooperacion      String?              @db.VarChar(50)
  fechatransaccion     DateTime?            @db.Date
  monto                Decimal?             @db.Decimal(10, 2)
  conciliado           Boolean?             @default(false)
  diferencia           Decimal?             @db.Decimal(10, 2)
  observaciones        String?
  conciliacionbancaria conciliacionbancaria @relation(fields: [conciliacion_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_concdet_conciliacion")
  pago                 pago?                @relation(fields: [pago_id], references: [id], onUpdate: NoAction, map: "fk_concdet_pago")

  @@index([conciliacion_id], map: "idx_concdet_conciliacion")
  @@index([numerooperacion], map: "idx_concdet_operacion")
  @@index([pago_id], map: "idx_concdet_pago")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model configuracioninstitucion {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  codigomodular        String                 @unique @db.VarChar(20)
  nombre               String                 @db.VarChar(255)
  ugel                 String                 @db.VarChar(100)
  distrito             String                 @db.VarChar(100)
  provincia            String?                @db.VarChar(100)
  departamento         String?                @db.VarChar(100)
  direccion            String?
  telefono             String?                @db.VarChar(20)
  email                String?                @db.VarChar(100)
  logo_url             String?
  nombredirector       String?                @db.VarChar(255)
  cargodirector        String?                @default("Director") @db.VarChar(100)
  firma_url            String?
  textolegal           String?
  activo               Boolean?               @default(true)
  fechaactualizacion   DateTime?              @default(now()) @db.Timestamptz(6)
  aniolectivo          aniolectivo[]
  areacurricular       areacurricular[]
  certificado          certificado[]
  conciliacionbancaria conciliacionbancaria[]
  estudiante           estudiante[]
  grado                grado[]
  institucionusuario   institucionusuario[]
  libro                libro[]
  metodopago           metodopago[]
  niveleducativo       niveleducativo[]
  pago                 pago[]
  pasarelapago         pasarelapago[]
  rol                  rol[]
  tiposolicitud        tiposolicitud[]

  @@index([codigomodular], map: "idx_institucion_codigo")
}

model curriculogrado {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  area_id        String         @db.Uuid
  grado_id       String         @db.Uuid
  aniolectivo_id String         @db.Uuid
  orden          Int
  activo         Boolean?       @default(true)
  aniolectivo    aniolectivo    @relation(fields: [aniolectivo_id], references: [id], onUpdate: NoAction, map: "fk_curriculo_anio")
  areacurricular areacurricular @relation(fields: [area_id], references: [id], onUpdate: NoAction, map: "fk_curriculo_area")
  grado          grado          @relation(fields: [grado_id], references: [id], onUpdate: NoAction, map: "fk_curriculo_grado")

  @@unique([area_id, grado_id, aniolectivo_id])
  @@index([aniolectivo_id], map: "idx_curriculo_anio")
  @@index([area_id], map: "idx_curriculo_area")
  @@index([grado_id], map: "idx_curriculo_grado")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model estudiante {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @default(dbgenerated("obtener_institucion_sesion()")) @db.Uuid
  dni                      String                   @db.VarChar(8)
  apellidopaterno          String                   @db.VarChar(100)
  apellidomaterno          String                   @db.VarChar(100)
  nombres                  String                   @db.VarChar(150)
  nombrecompleto           String?                  @default(dbgenerated("(((((nombres)::text || ' '::text) || (apellidopaterno)::text) || ' '::text) || (apellidomaterno)::text)")) @db.VarChar(400)
  fechanacimiento          DateTime                 @db.Date
  lugarnacimiento          String?                  @db.VarChar(150)
  sexo                     String?                  @default("M") @db.Char(1)
  email                    String?                  @db.VarChar(100)
  telefono                 String?                  @db.VarChar(20)
  direccion                String?
  observaciones            String?
  estado                   String?                  @default("ACTIVO") @db.VarChar(20)
  fecharegistro            DateTime?                @default(now()) @db.Timestamptz(6)
  fechaactualizacion       DateTime?                @default(now()) @db.Timestamptz(6)
  certificado              certificado[]
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onUpdate: NoAction, map: "fk_estudiante_institucion")
  solicitud                solicitud[]

  @@unique([institucion_id, dni])
  @@index([apellidopaterno, apellidomaterno], map: "idx_estudiante_apellidos")
  @@index([fechanacimiento], map: "idx_estudiante_fechanacimiento")
  @@index([institucion_id, dni], map: "idx_estudiante_inst_dni")
  @@index([institucion_id], map: "idx_estudiante_institucion")
  @@index([nombrecompleto(ops: raw("gin_trgm_ops"))], map: "idx_estudiante_nombrecompleto", type: Gin)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model grado {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @default(dbgenerated("obtener_institucion_sesion()")) @db.Uuid
  nivel_id                 String?                  @db.Uuid
  numero                   Int
  nombre                   String                   @db.VarChar(50)
  nombrecorto              String?                  @db.VarChar(20)
  orden                    Int
  activo                   Boolean?                 @default(true)
  actafisica               actafisica[]
  certificadodetalle       certificadodetalle[]
  curriculogrado           curriculogrado[]
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onUpdate: NoAction, map: "fk_grado_institucion")
  niveleducativo           niveleducativo?          @relation(fields: [nivel_id], references: [id], onUpdate: NoAction, map: "fk_grado_nivel")

  @@unique([institucion_id, nivel_id, numero])
  @@index([institucion_id], map: "idx_grado_institucion")
  @@index([nivel_id], map: "idx_grado_nivel")
}

model libro {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @default(dbgenerated("obtener_institucion_sesion()")) @db.Uuid
  codigo                   String                   @db.VarChar(50)
  descripcion              String?                  @db.VarChar(255)
  ubicacion_fisica         String?                  @db.VarChar(255)
  anio_inicio              Int?
  anio_fin                 Int?
  total_folios             Int?
  estado                   String?                  @default("ACTIVO") @db.VarChar(20)
  observaciones            String?
  fecha_creacion           DateTime?                @default(now()) @db.Timestamptz(6)
  activo                   Boolean?                 @default(true)
  
  actafisica               actafisica[]
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onUpdate: NoAction, map: "fk_libro_institucion")
  
  @@unique([institucion_id, codigo])
  @@index([institucion_id], map: "idx_libro_institucion")
  @@index([estado], map: "idx_libro_estado")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model institucionusuario {
  id                                                   String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id                                       String                   @db.Uuid
  usuario_id                                           String                   @db.Uuid
  esadministrador                                      Boolean?                 @default(false)
  activo                                               Boolean?                 @default(true)
  fechaasignacion                                      DateTime?                @default(now()) @db.Timestamptz(6)
  usuarioasigno_id                                     String?                  @db.Uuid
  usuario_institucionusuario_usuarioasigno_idTousuario usuario?                 @relation("institucionusuario_usuarioasigno_idTousuario", fields: [usuarioasigno_id], references: [id], onUpdate: NoAction, map: "fk_instuser_asignador")
  configuracioninstitucion                             configuracioninstitucion @relation(fields: [institucion_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_instuser_institucion")
  usuario_institucionusuario_usuario_idTousuario       usuario                  @relation("institucionusuario_usuario_idTousuario", fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_instuser_usuario")

  @@unique([institucion_id, usuario_id])
  @@index([institucion_id], map: "idx_instuser_institucion")
  @@index([usuario_id], map: "idx_instuser_usuario")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model metodopago {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @db.Uuid
  codigo                   String                   @db.VarChar(30)
  nombre                   String                   @db.VarChar(100)
  tipo                     String                   @db.VarChar(30)
  descripcion              String?
  requierevalidacion       Boolean?                 @default(true)
  comisionporcentaje       Decimal?                 @db.Decimal(5, 2)
  comisionfija             Decimal?                 @db.Decimal(10, 2)
  activo                   Boolean?                 @default(true)
  configuracion            Json?
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_metodopago_institucion")
  pagodetalle              pagodetalle[]

  @@unique([institucion_id, codigo])
  @@index([institucion_id, codigo], map: "idx_metodopago_codigo")
  @@index([institucion_id], map: "idx_metodopago_institucion")
  @@index([tipo], map: "idx_metodopago_tipo")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model niveleducativo {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @default(dbgenerated("obtener_institucion_sesion()")) @db.Uuid
  codigo                   String                   @db.VarChar(20)
  nombre                   String                   @db.VarChar(100)
  descripcion              String?
  orden                    Int
  activo                   Boolean?                 @default(true)
  grado                    grado[]
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_nivel_institucion")

  @@unique([institucion_id, codigo])
  @@index([institucion_id, codigo], map: "idx_nivel_codigo")
  @@index([institucion_id], map: "idx_nivel_institucion")
}

model notificacion {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tipo           String       @db.VarChar(30)
  destinatario   String       @db.VarChar(150)
  asunto         String?      @db.VarChar(255)
  mensaje        String
  canal          String       @db.VarChar(20)
  solicitud_id   String?      @db.Uuid
  certificado_id String?      @db.Uuid
  estado         String?      @default("PENDIENTE") @db.VarChar(20)
  intentos       Int?         @default(0)
  fechaenvio     DateTime?    @db.Timestamptz(6)
  fechaleido     DateTime?    @db.Timestamptz(6)
  error          String?
  fechacreacion  DateTime?    @default(now()) @db.Timestamptz(6)
  certificado    certificado? @relation(fields: [certificado_id], references: [id], onUpdate: NoAction, map: "fk_notif_certificado")
  solicitud      solicitud?   @relation(fields: [solicitud_id], references: [id], onUpdate: NoAction, map: "fk_notif_solicitud")

  @@index([canal], map: "idx_notif_canal")
  @@index([certificado_id], map: "idx_notif_certificado")
  @@index([destinatario], map: "idx_notif_destinatario")
  @@index([estado], map: "idx_notif_estado")
  @@index([solicitud_id], map: "idx_notif_solicitud")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model pago {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @default(dbgenerated("obtener_institucion_sesion()")) @db.Uuid
  numeroorden              String                   @unique @db.VarChar(50)
  numerooperacion          String?                  @db.VarChar(50)
  monto                    Decimal                  @db.Decimal(10, 2)
  moneda                   String?                  @default("PEN") @db.VarChar(3)
  comision                 Decimal?                 @default(0) @db.Decimal(10, 2)
  montoneto                Decimal?                 @db.Decimal(10, 2)
  metodopago               String?                  @db.VarChar(30)
  entidadbancaria          String?                  @db.VarChar(100)
  referenciapago           String?                  @db.VarChar(100)
  fechapago                DateTime                 @db.Date
  horapago                 DateTime?                @db.Time(6)
  numerorecibo             String?                  @db.VarChar(50)
  urlcomprobante           String?
  estado                   String?                  @default("PENDIENTE") @db.VarChar(20)
  conciliado               Boolean?                 @default(false)
  fechaconciliacion        DateTime?                @db.Timestamptz(6)
  usuarioconciliacion_id   String?                  @db.Uuid
  observaciones            String?
  fecharegistro            DateTime?                @default(now()) @db.Timestamptz(6)
  conciliaciondetalle      conciliaciondetalle[]
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onUpdate: NoAction, map: "fk_pago_institucion")
  usuario                  usuario?                 @relation(fields: [usuarioconciliacion_id], references: [id], onUpdate: NoAction, map: "fk_pago_usuario")
  pagodetalle              pagodetalle[]
  solicitud                solicitud[]
  webhookpago              webhookpago[]

  @@index([estado], map: "idx_pago_estado")
  @@index([institucion_id, fechapago(sort: Desc)], map: "idx_pago_inst_fecha")
  @@index([institucion_id], map: "idx_pago_institucion")
  @@index([numerooperacion], map: "idx_pago_numerooperacion")
  @@index([numeroorden], map: "idx_pago_numeroorden")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model pagodetalle {
  id                 String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pago_id            String     @db.Uuid
  metodopago_id      String     @db.Uuid
  monto              Decimal    @db.Decimal(10, 2)
  moneda             String?    @default("PEN") @db.VarChar(3)
  numerocelular      String?    @db.VarChar(15)
  nombretitular      String?    @db.VarChar(200)
  terminal_id        String?    @db.VarChar(50)
  lote               String?    @db.VarChar(20)
  trace              String?    @db.VarChar(20)
  codigoautorizacion String?    @db.VarChar(50)
  ultimos4digitos    String?    @db.VarChar(4)
  tipotarjeta        String?    @db.VarChar(30)
  cuotas             Int?       @default(1)
  qr_code            String?
  qr_id              String?    @db.VarChar(100)
  transaction_id     String?    @db.VarChar(100)
  pasarela           String?    @db.VarChar(50)
  merchant_id        String?    @db.VarChar(100)
  commerce_code      String?    @db.VarChar(50)
  responsejson       Json?
  fechatransaccion   DateTime?  @default(now()) @db.Timestamptz(6)
  metodopago         metodopago @relation(fields: [metodopago_id], references: [id], onUpdate: NoAction, map: "fk_pagodet_metodo")
  pago               pago       @relation(fields: [pago_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_pagodet_pago")

  @@index([numerocelular], map: "idx_pagodet_celular")
  @@index([metodopago_id], map: "idx_pagodet_metodo")
  @@index([pago_id], map: "idx_pagodet_pago")
  @@index([pasarela], map: "idx_pagodet_pasarela")
  @@index([transaction_id], map: "idx_pagodet_transaction")
}

model parametro {
  id                      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  codigo                  String    @unique @db.VarChar(50)
  nombre                  String    @db.VarChar(100)
  valor                   String
  tipo                    String    @db.VarChar(30)
  descripcion             String?
  modificable             Boolean?  @default(true)
  fechaactualizacion      DateTime? @default(now()) @db.Timestamptz(6)
  usuarioactualizacion_id String?   @db.Uuid
  usuario                 usuario?  @relation(fields: [usuarioactualizacion_id], references: [id], onUpdate: NoAction, map: "fk_parametro_usuario")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model pasarelapago {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @db.Uuid
  codigo                   String                   @db.VarChar(30)
  nombre                   String                   @db.VarChar(100)
  descripcion              String?
  merchant_id              String?                  @db.VarChar(100)
  commerce_code            String?                  @db.VarChar(100)
  api_key_encrypted        String?
  api_secret_encrypted     String?
  webhook_url              String?
  webhook_secret           String?
  ambiente                 String?                  @default("SANDBOX") @db.VarChar(20)
  activo                   Boolean?                 @default(true)
  configuracion            Json?
  fechaactualizacion       DateTime?                @default(now()) @db.Timestamptz(6)
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_pasarela_institucion")
  webhookpago              webhookpago[]

  @@unique([institucion_id, codigo])
  @@index([institucion_id, codigo], map: "idx_pasarela_codigo")
  @@index([institucion_id], map: "idx_pasarela_institucion")
}

model permiso {
  id         String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  codigo     String       @unique @db.VarChar(50)
  nombre     String       @db.VarChar(100)
  modulo     String       @db.VarChar(50)
  activo     Boolean?     @default(true)
  rolpermiso rolpermiso[]
}

model rol {
  id                       String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String?                   @db.Uuid
  codigo                   String                    @db.VarChar(30)
  nombre                   String                    @db.VarChar(100)
  descripcion              String?
  nivel                    Int
  activo                   Boolean?                  @default(true)
  configuracioninstitucion configuracioninstitucion? @relation(fields: [institucion_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_rol_institucion")
  rolpermiso               rolpermiso[]
  usuariorol               usuariorol[]

  @@unique([institucion_id, codigo])
  @@index([institucion_id, codigo], map: "idx_rol_codigo")
  @@index([institucion_id], map: "idx_rol_institucion")
}

model rolpermiso {
  rol_id     String  @db.Uuid
  permiso_id String  @db.Uuid
  permiso    permiso @relation(fields: [permiso_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_rolperm_permiso")
  rol        rol     @relation(fields: [rol_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_rolperm_rol")

  @@id([rol_id, permiso_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model sesion {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  usuario_id      String    @db.Uuid
  token           String    @unique @db.Text
  ip              String?   @db.VarChar(45)
  useragent       String?   @db.Text
  fechainicio     DateTime? @default(now()) @db.Timestamptz(6)
  fechaexpiracion DateTime  @db.Timestamptz(6)
  fechacierre     DateTime? @db.Timestamptz(6)
  activa          Boolean?  @default(true)
  usuario         usuario   @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_sesion_usuario")

  @@index([token], map: "idx_sesion_token")
  @@index([usuario_id], map: "idx_sesion_usuario")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model solicitud {
  id                                                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  numeroexpediente                                    String?              @unique @db.VarChar(50)
  estudiante_id                                       String               @db.Uuid
  tiposolicitud_id                                    String               @db.Uuid
  modalidadentrega                                    String?              @db.VarChar(30)
  direccionentrega                                    String?
  numeroseguimiento                                   String?              @db.VarChar(50)
  estado                                              String?              @default("REGISTRADA") @db.VarChar(30)
  prioridad                                           String?              @default("NORMAL") @db.VarChar(20)
  pago_id                                             String?              @db.Uuid
  certificado_id                                      String?              @db.Uuid
  fechasolicitud                                      DateTime?            @default(now()) @db.Timestamptz(6)
  fechavalidacionpago                                 DateTime?            @db.Timestamptz(6)
  fechainicioproceso                                  DateTime?            @db.Timestamptz(6)
  fechageneracioncertificado                          DateTime?            @db.Timestamptz(6)
  fechafirma                                          DateTime?            @db.Timestamptz(6)
  fechaentrega                                        DateTime?            @db.Timestamptz(6)
  fecharechazo                                        DateTime?            @db.Timestamptz(6)
  motivorechazo                                       String?
  observaciones                                       String?
  usuariosolicitud_id                                 String?              @db.Uuid
  usuariovalidacionpago_id                            String?              @db.Uuid
  usuariogeneracion_id                                String?              @db.Uuid
  usuariofirma_id                                     String?              @db.Uuid
  usuarioentrega_id                                   String?              @db.Uuid
  fechaactualizacion                                  DateTime?            @default(now()) @db.Timestamptz(6)
  notificacion                                        notificacion[]
  certificado                                         certificado?         @relation(fields: [certificado_id], references: [id], onUpdate: NoAction, map: "fk_solicitud_certificado")
  usuario_solicitud_usuarioentrega_idTousuario        usuario?             @relation("solicitud_usuarioentrega_idTousuario", fields: [usuarioentrega_id], references: [id], onUpdate: NoAction, map: "fk_solicitud_entregador")
  estudiante                                          estudiante           @relation(fields: [estudiante_id], references: [id], onUpdate: NoAction, map: "fk_solicitud_estudiante")
  usuario_solicitud_usuariofirma_idTousuario          usuario?             @relation("solicitud_usuariofirma_idTousuario", fields: [usuariofirma_id], references: [id], onUpdate: NoAction, map: "fk_solicitud_firmante")
  usuario_solicitud_usuariogeneracion_idTousuario     usuario?             @relation("solicitud_usuariogeneracion_idTousuario", fields: [usuariogeneracion_id], references: [id], onUpdate: NoAction, map: "fk_solicitud_generador")
  pago                                                pago?                @relation(fields: [pago_id], references: [id], onUpdate: NoAction, map: "fk_solicitud_pago")
  tiposolicitud                                       tiposolicitud        @relation(fields: [tiposolicitud_id], references: [id], onUpdate: NoAction, map: "fk_solicitud_tipo")
  usuario_solicitud_usuariosolicitud_idTousuario      usuario?             @relation("solicitud_usuariosolicitud_idTousuario", fields: [usuariosolicitud_id], references: [id], onUpdate: NoAction, map: "fk_solicitud_usuario")
  usuario_solicitud_usuariovalidacionpago_idTousuario usuario?             @relation("solicitud_usuariovalidacionpago_idTousuario", fields: [usuariovalidacionpago_id], references: [id], onUpdate: NoAction, map: "fk_solicitud_validador_pago")
  actafisica                                          actafisica[]
  solicitudhistorial                                  solicitudhistorial[]

  @@index([certificado_id], map: "idx_solicitud_certificado")
  @@index([estado], map: "idx_solicitud_estado")
  @@index([estudiante_id], map: "idx_solicitud_estudiante")
  @@index([estudiante_id, estado], map: "idx_solicitud_estudiante_estado")
  @@index([fechasolicitud(sort: Desc)], map: "idx_solicitud_fechasolicitud")
  @@index([numeroexpediente], map: "idx_solicitud_numeroexpediente")
  @@index([pago_id], map: "idx_solicitud_pago")
  @@index([tiposolicitud_id], map: "idx_solicitud_tipo")
}

model solicitudhistorial {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  solicitud_id   String    @db.Uuid
  estadoanterior String?   @db.VarChar(30)
  estadonuevo    String    @db.VarChar(30)
  observaciones  String?
  usuario_id     String?   @db.Uuid
  fecha          DateTime? @default(now()) @db.Timestamptz(6)
  solicitud      solicitud @relation(fields: [solicitud_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_solhist_solicitud")
  usuario        usuario?  @relation(fields: [usuario_id], references: [id], onUpdate: NoAction, map: "fk_solhist_usuario")

  @@index([fecha(sort: Desc)], map: "idx_solhist_fecha")
  @@index([solicitud_id], map: "idx_solhist_solicitud")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tiposolicitud {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institucion_id           String                   @default(dbgenerated("obtener_institucion_sesion()")) @db.Uuid
  codigo                   String                   @db.VarChar(30)
  nombre                   String                   @db.VarChar(100)
  descripcion              String?
  requierepago             Boolean?                 @default(true)
  montobase                Decimal?                 @db.Decimal(10, 2)
  tiempoentregadias        Int?
  activo                   Boolean?                 @default(true)
  solicitud                solicitud[]
  configuracioninstitucion configuracioninstitucion @relation(fields: [institucion_id], references: [id], onUpdate: NoAction, map: "fk_tiposol_institucion")

  @@unique([institucion_id, codigo])
  @@index([institucion_id, codigo], map: "idx_tiposol_codigo")
  @@index([institucion_id], map: "idx_tiposol_institucion")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model usuario {
  id                                                              String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username                                                        String                 @unique @db.VarChar(50)
  email                                                           String                 @unique @db.VarChar(100)
  passwordhash                                                    String                 @db.VarChar(255)
  dni                                                             String?                @unique @db.VarChar(8)
  nombres                                                         String?                @db.VarChar(150)
  apellidos                                                       String?                @db.VarChar(150)
  telefono                                                        String?                @db.VarChar(20)
  cargo                                                           String?                @db.VarChar(100)
  ultimoacceso                                                    DateTime?              @db.Timestamptz(6)
  intentosfallidos                                                Int?                   @default(0)
  bloqueado                                                       Boolean?               @default(false)
  fechabloqueo                                                    DateTime?              @db.Timestamptz(6)
  activo                                                          Boolean?               @default(true)
  cambiarpassword                                                 Boolean?               @default(true)
  fechacreacion                                                   DateTime?              @default(now()) @db.Timestamptz(6)
  fechaactualizacion                                              DateTime?              @default(now()) @db.Timestamptz(6)
  actafisica                                                      actafisica[]
  auditoria                                                       auditoria[]
  certificado_certificado_usuarioanulacion_idTousuario            certificado[]          @relation("certificado_usuarioanulacion_idTousuario")
  certificado_certificado_usuarioemision_idTousuario              certificado[]          @relation("certificado_usuarioemision_idTousuario")
  conciliacionbancaria                                            conciliacionbancaria[]
  institucionusuario_institucionusuario_usuarioasigno_idTousuario institucionusuario[]   @relation("institucionusuario_usuarioasigno_idTousuario")
  institucionusuario_institucionusuario_usuario_idTousuario       institucionusuario[]   @relation("institucionusuario_usuario_idTousuario")
  pago                                                            pago[]
  parametro                                                       parametro[]
  sesion                                                          sesion[]
  solicitud_solicitud_usuarioentrega_idTousuario                  solicitud[]            @relation("solicitud_usuarioentrega_idTousuario")
  solicitud_solicitud_usuariofirma_idTousuario                    solicitud[]            @relation("solicitud_usuariofirma_idTousuario")
  solicitud_solicitud_usuariogeneracion_idTousuario               solicitud[]            @relation("solicitud_usuariogeneracion_idTousuario")
  solicitud_solicitud_usuariosolicitud_idTousuario                solicitud[]            @relation("solicitud_usuariosolicitud_idTousuario")
  solicitud_solicitud_usuariovalidacionpago_idTousuario           solicitud[]            @relation("solicitud_usuariovalidacionpago_idTousuario")
  solicitudhistorial                                              solicitudhistorial[]
  usuariorol_usuariorol_usuarioasigno_idTousuario                 usuariorol[]           @relation("usuariorol_usuarioasigno_idTousuario")
  usuariorol_usuariorol_usuario_idTousuario                       usuariorol[]           @relation("usuariorol_usuario_idTousuario")

  @@index([dni], map: "idx_usuario_dni")
  @@index([email], map: "idx_usuario_email")
  @@index([username], map: "idx_usuario_username")
}

model usuariorol {
  usuario_id                                   String    @db.Uuid
  rol_id                                       String    @db.Uuid
  fechaasignacion                              DateTime? @default(now()) @db.Timestamptz(6)
  activo                                       Boolean?  @default(true)
  usuarioasigno_id                             String?   @db.Uuid
  usuario_usuariorol_usuarioasigno_idTousuario usuario?  @relation("usuariorol_usuarioasigno_idTousuario", fields: [usuarioasigno_id], references: [id], onUpdate: NoAction, map: "fk_usurol_asignador")
  rol                                          rol       @relation(fields: [rol_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_usurol_rol")
  usuario_usuariorol_usuario_idTousuario       usuario   @relation("usuariorol_usuario_idTousuario", fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_usurol_usuario")

  @@id([usuario_id, rol_id])
  @@index([rol_id], map: "idx_usurol_rol")
  @@index([usuario_id], map: "idx_usurol_usuario")
}

model verificacion {
  id               String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  codigovirtual    String       @db.VarChar(50)
  certificado_id   String?      @db.Uuid
  fecha            DateTime?    @default(now()) @db.Timestamptz(6)
  ip               String?      @db.VarChar(45)
  useragent        String?
  ubicacion        String?      @db.VarChar(255)
  resultado        String       @db.VarChar(30)
  detalleresultado String?
  tipoconsulta     String?      @db.VarChar(30)
  certificado      certificado? @relation(fields: [certificado_id], references: [id], onUpdate: NoAction, map: "fk_verificacion_certificado")

  @@index([certificado_id], map: "idx_verificacion_certificado")
  @@index([codigovirtual], map: "idx_verificacion_codigo")
  @@index([fecha(sort: Desc)], map: "idx_verificacion_fecha")
  @@index([ip], map: "idx_verificacion_ip")
  @@index([resultado], map: "idx_verificacion_resultado")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model webhookpago {
  id                 String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pasarela_id        String?       @db.Uuid
  pago_id            String?       @db.Uuid
  evento             String        @db.VarChar(50)
  payload            Json
  headers            Json?
  ip                 String?       @db.VarChar(45)
  procesado          Boolean?      @default(false)
  fechaprocesamiento DateTime?     @db.Timestamptz(6)
  error              String?
  fecharecepcion     DateTime?     @default(now()) @db.Timestamptz(6)
  pago               pago?         @relation(fields: [pago_id], references: [id], onUpdate: NoAction, map: "fk_webhook_pago")
  pasarelapago       pasarelapago? @relation(fields: [pasarela_id], references: [id], onUpdate: NoAction, map: "fk_webhook_pasarela")

  @@index([fecharecepcion(sort: Desc)], map: "idx_webhook_fecha")
  @@index([pago_id], map: "idx_webhook_pago")
  @@index([pasarela_id], map: "idx_webhook_pasarela")
}
